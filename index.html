<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <title>LinkCheck</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="container">
    <h1>LinkCheck</h1>
    <input type="text" id="urlInput" placeholder="ê²€ì‚¬í•  URL ì…ë ¥">
    <button id="checkButton" disabled>ê²€ì‚¬</button>
    <div id="result"></div>
  </div>

  <script>
    const dangerousSites = [
      "joetracker", "qoogler", "seriall", "getavirus", "yhaho.com",
      "tango-deg.com", "thebestgame2020.com", "trupir-asia.info",
      "inwords.website", "goooogle.com", "wwwnaver.com", "ì¢Œê´€ì´ì•„",
      "gelsifying.info", "aimeblog", "bnatsaba", "crashie.com",
      "FAST DOWNLOAD ARCHIVE", "goggle.com",
      "yotube.com", "youtyube.com", "wwwyoutube.com", "Poshukach",
      "coocle.com", "ggole.com", "theannoyingsite.com", "VX Vault"
    ];

    const foreignDomains = [".cn", ".ru", ".pl", ".fr", ".tk", ".xyz"];
    const riskyKeywords = ["login", "bank", "free-money"];
    const patternScores = { "impersonate": 2, "bait": 2, "trojan": 3, "popup": 1, "creepy": 1 };

    let dangerWords = [];
    let adultWords = [];

    // ğŸ”¹ ë‘ CSV ë™ì‹œì— ë¡œë“œ
    const loadCSVs = async () => {
      try {
        const [dangerText, adultText] = await Promise.all([
          fetch("dangerous.csv").then(res => res.text()),
          fetch("adult.csv").then(res => res.text())
        ]);

        dangerWords = dangerText.split(/\r?\n/).map(v => v.trim().toLowerCase()).filter(Boolean);
        adultWords = adultText.split(/\r?\n/).map(v => v.trim().toLowerCase()).filter(Boolean);

        console.log("CSV ìœ„í—˜ ë‹¨ì–´ ë¡œë“œ ì™„ë£Œ:", dangerWords, adultWords);

        // CSV ë¡œë“œ ì™„ë£Œ í›„ ë²„íŠ¼ í™œì„±í™”
        document.getElementById("checkButton").disabled = false;
      } catch (err) {
        console.error("CSV ë¡œë”© ì‹¤íŒ¨:", err);
      }
    };

    loadCSVs();

    function extractDomain(url) {
      try {
        const u = new URL(url);
        return u.hostname.replace('www.', '');
      } catch {
        return url;
      }
    }

    function getKoreanRatio(text) {
      const kor = text.match(/[ê°€-í£]/g);
      if (!kor) return 0;
      return kor.length / text.length;
    }

    document.getElementById("checkButton").addEventListener("click", checkLink);

    function checkLink() {
      const url = document.getElementById('urlInput').value.trim();
      const resultDiv = document.getElementById('result');
      let score = 0;
      let messages = [];

      if (!url) {
        resultDiv.textContent = "URLì„ ì…ë ¥í•˜ì„¸ìš”!";
        resultDiv.className = "danger";
        return;
      }

      if (!dangerWords.length || !adultWords.length) {
        resultDiv.textContent = "âš ï¸ CSVê°€ ì•„ì§ ë¡œë“œ ì¤‘ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”.";
        resultDiv.className = "danger";
        return;
      }

      const domain = extractDomain(url);
      const lowerUrl = url.toLowerCase();

      // ğŸ”¹ ê¸°ì¡´ ìœ„í—˜ ì‚¬ì´íŠ¸ ì²´í¬
      if (dangerousSites.includes(domain)) { score += 2; messages.push("ìœ„í—˜ ì‚¬ì´íŠ¸ ë„ë©”ì¸ í¬í•¨"); }
      if (!url.startsWith("https://")) { score += 2; messages.push("HTTPSê°€ ì•„ë‹™ë‹ˆë‹¤"); }
      if (url.length > 50) { score += 1; messages.push("URL ê¸¸ì´ê°€ ê¸¸ì–´ìš”"); }
      if (url.length < 10) { score += 1; messages.push("URLì´ ë„ˆë¬´ ì§§ì•„ìš”"); }
      const specialChars = url.match(/[@#$%^&*()<>?]/g);
      if (specialChars && specialChars.length > 2) { score += 2; messages.push("íŠ¹ìˆ˜ë¬¸ìê°€ ë§ì•„ìš”"); }
      if (/%[0-9A-Fa-f]{2}/.test(url)) { score += 1; messages.push("ì¸ì½”ë”©ëœ ë¬¸ì í¬í•¨"); }
      if (/https?:\/\/(\d{1,3}\.){3}\d{1,3}/.test(url)) { score += 3; messages.push("IP ì£¼ì†Œ í˜•íƒœ URLì…ë‹ˆë‹¤"); }
      if (foreignDomains.some(ext => domain.endsWith(ext))) { score += 2; messages.push("ì™¸êµ­ ë„ë©”ì¸ì…ë‹ˆë‹¤"); }
      const koreanRatio = getKoreanRatio(url);
      if (koreanRatio > 0 && koreanRatio <= 0.2) { score += 1; messages.push("ì–´ìƒ‰í•œ í•œêµ­ì–´ ë¹„ìœ¨"); }
      if (riskyKeywords.some(keyword => lowerUrl.includes(keyword))) { score += 2; messages.push("í”¼ì‹±/ìœ„í—˜ í‚¤ì›Œë“œ í¬í•¨"); }

      // ğŸ”¹ ìœ„í—˜ íŒ¨í„´ ì‹œë®¬ë ˆì´ì…˜
      if (["joetracker", "qoogler", "seriall", "trupir-asia.info", "goooogle.com", "ì¢Œê´€ì´ì•„"].includes(domain)) {
        score += patternScores["trojan"]; messages.push("íŠ¸ë¡œì´ ëª©ë§ˆ/ë°”ì´ëŸ¬ìŠ¤ ë‹¤ìš´ë¡œë“œ ìœ ë„");
      }
      if (["tango-deg.com", "wwwnaver.com", "wwwyoutube.com", "yotube.com", "youtyube.com", "coocle.com", "ggole.com", "theannoyingsite.com"].includes(domain)) {
        score += patternScores["popup"]; messages.push("ë¬´í•œ ê´‘ê³ /íŒì—…");
      }
      if (["ì¢Œê´€ì´ì•„", "trupir-asia.info", "VX Vault"].includes(domain)) {
        score += patternScores["creepy"]; messages.push("ê¸°ê´´í•œ ì½˜í…ì¸  í¬í•¨");
      }

      // ğŸ”¹ CSV ì¼ë°˜ ìœ„í—˜ ë‹¨ì–´ ì²´í¬
      for (const word of dangerWords) {
        if (lowerUrl.includes(word)) {
          score += 5;
          messages.push(`CSV ìœ„í—˜ ë‹¨ì–´ í¬í•¨: ${word}`);
        }
      }

      // ğŸ”¹ CSV ìŒë€ë¬¼ ë‹¨ì–´ ì²´í¬
      let adultFlag = false;
      for (const word of adultWords) {
        if (lowerUrl.includes(word)) {
          adultFlag = true;
          messages.push(`âš ï¸ ìŒë€ë¬¼ ì£¼ì˜: ${word}`);
        }
      }

      // ğŸ”¹ ê²°ê³¼ ì¶œë ¥
      if (score >= 3 || adultFlag) {
        resultDiv.textContent = messages.join(", ");
        resultDiv.className = "danger";
      } else {
        resultDiv.textContent = "âœ… ì•ˆì „í•´ ë³´ì…ë‹ˆë‹¤";
        resultDiv.className = "safe";
      }
    }
  </script>
</body>

</html>
